apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: kibana
  namespace: elasticsearch
  labels:
    hostk8s.app: kibana
  annotations:
    eck.k8s.alpha.elastic.co/propagate-labels: "hostk8s.app"
spec:
  version: 9.1.3
  count: 1  # Single instance for development

  # Reference to the Elasticsearch cluster
  elasticsearchRef:
    name: elasticsearch

  # Disable TLS for local development
  http:
    tls:
      selfSignedCertificate:
        disabled: true
    service:
      spec:
        type: ClusterIP

  # Pod configuration
  podTemplate:
    metadata:
      labels:
        hostk8s.app: kibana
    spec:
      containers:
        - name: kibana
          env:
            # Elasticsearch connection (HTTP without TLS)
            - name: ELASTICSEARCH_HOSTS
              value: "http://elasticsearch-es-http.elasticsearch:9200"
            # Disable some production features for dev
            - name: MONITORING_ENABLED
              value: "false"
            - name: TELEMETRY_ENABLED
              value: "false"
          resources:
            requests:
              memory: 512Mi
              cpu: 100m
            limits:
              memory: 1Gi
              cpu: 500m
